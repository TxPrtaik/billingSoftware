<%-include('navbar.ejs')%>
<style>
    .modal-box{
        position: absolute;
        left: 35%;
        top: 5%;
        width: 350px;
       
        z-index: 9999999999;
        
        height: 150px;
    }
</style>
<div class="container p-4">
  <div class="w-100 text-center mb-3">
    <h2>Add Medicines</h2>
  </div>
<button type="button" id="alert"  class="btn btn-primary d-none" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
    Launch static backdrop modal
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
     
        <div class="modal-body">
        <div class="alert alert-success">
        Medicine is added successfully
        <i class="fa-regular fa-circle-check  float-end"></i>    
       
        </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="reload()">Okay</button>
     
        </div>
      </div>
    </div>
  </div>
  

       <div class="row p-3 " style="overflow-x: scroll;">
        <table class="table table-striped table-primary  table-bordered">
<tr>
    <th>
        Medicine Name
    </th>
    
    <th>
        Packing
    </th>
    <th>
        Batch ID
    </th>
    <th>
        Ex. Date (mm/yy)
    </th>
    <th>
        Qantity
    </th>
    <th>
        MRP
    </th>
    <th>
        Rate
    </th>
    <th>
        Amount
    </th>
    <th>
        <button class="btn btn-primary" onclick="addRow()">+</button>
    </th>
</tr>



<tbody id="myform">

</tbody>

<tfoot>
    <tr>
        <td colspan="9">    <button class="btn btn-primary float-end" onclick="sendData()" id="savebtn" disabled>Save</button>
        </td>
    </tr>
   
</tfoot>



        </table>
       </div>
    
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    let i=0;
    function addRow(){
        ++i;
        $("#myform").append(` <tr>
      

       
<td><input type="text" name="pname" class="form-control shadow-none" placeholder="Medicine Name"></td>
<td><input type="text" name="ppacking" class="form-control shadow-none" placeholder="packing type" ></td>    
<td><input type="text" name="pbatchid" class="form-control shadow-none"  placeholder="Batch Id"></td> 
<td>   <input type="month" name="pexp" class="form-control shadow-none" ></td> 
<td>   <input type="number" name="pqty" placeholder="Quantity" class="form-control shadow-none" ></td> 
<td>          <input type="number" placeholder="MRP" name="pmrp" class="form-control shadow-none" ></td> 
<td>          <input type="number" placeholder="Rate" name="prate" class="form-control shadow-none" ></td> 
<td>          <input type="number" placeholder="Amount" name="pamt" class="form-control shadow-none" ></td> 
<td><button class="btn btn-danger" onClick="delRow()"><i class="fa fa-trash"></i></button></td>
</tr>`);
checkSave();   
}
    function delRow(){
        --i;
   let r=event.target.closest('tr');
   r.remove();
   checkSave();
    }
    function checkSave(){

    if(i>0){
        
document.getElementById('savebtn').disabled=false;
}
else{
    document.getElementById('savebtn').disabled=true;   
}
}
  function sendData(){
    let obj={
        "pname":[],
        "packing":[],
        "bid":[],
        "exp":[],
        "qty":[],
        "mrp":[],
        "rate":[],
        "amt":[]
    }
    let pname=document.getElementsByName("pname");
    let ppacking=document.getElementsByName("ppacking");
    let pbatchid=document.getElementsByName("pbatchid");
    let pexp=document.getElementsByName("pexp");
    let pqty=document.getElementsByName("pqty");
    let pmrp=document.getElementsByName("pmrp");
    let prate=document.getElementsByName("prate");
    let pamt=document.getElementsByName("pamt");


    for(let n of pname){
        obj.pname.push(n.value);
    }
    for(let n of ppacking){
        obj.packing.push(n.value);
    }
    for(let n of pbatchid){
        obj.bid.push(n.value);
    }
    for(let n of pexp){
        obj.exp.push(n.value);
    }
    for(let n of pqty){
        obj.qty.push(n.value);
    }
    for(let n of pmrp){
        obj.mrp.push(n.value);
    }
    for(let n of prate){
        obj.rate.push(n.value);
    }
    for(let n of pamt){
        obj.amt.push(n.value);
    }
    
$.ajax({"url":"/save-purchase","method":"post","data":obj}).done((res)=>{
    if(res){
        document.getElementById("alert").click();
    }
})

    
  }
  function reload(){
    location.reload();
  }
    </script>

<%-include('footer.ejs')%>